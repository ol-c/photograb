<head>
  <title>photograb</title>
  <meta name="viewport"
        content="width=device-width,
                 initial-scale=1,
                 maximum-scale=1,
                 minimum-scale=1">
</head>

<body>
  {{#if currentPhotograb}}
    {{> photograb currentPhotograb}}
  {{/if}}
</body>

<template name="photograb">
  <div class="photograb">
    <div class="photograb-input-controls">
      <input type="file">
    </div>
    <div class="photograb-foreground-brush {{#if equals mode 'foreground'}}photograb-active-brush{{/if}}"></div>
    <div class="photograb-background-brush {{#if equals mode 'background'}}photograb-active-brush{{/if}}"></div>
    <div class="photograb-inner"
         style="left:{{x}}px;
                top:{{y}}px;
                transform-origin:0 0;
                -webkit-transform-origin:0 0;
                transform:scale({{scale}});
                -webkit-transform:scale({{scale}});">
      <div class="photograb-input">
        <img class="photograb-original"
             src="{{imageData}}">
        <svg class="input-overlay"
             width="{{width}}"
             height="{{height}}"
             viewbox="0 0 {{width}} {{height}}">
          {{#if maskPath}}{{> mask path=maskPath attributes=maskAttributes}}{{/if}}
          {{#each appliedMarks}}{{> mark}}{{/each}}
          <g class="photograb-waiting">
            {{#each unappliedMarks}}{{> mark}}{{/each}}
          </g>
          {{#if currentMark}}{{> mark currentMark }}{{/if}}
        </svg>
      </div>
      <div class="photograb-output">
        <img class="photograb-result"
             src="{{imageData}}"
             style="-webkit-clip-path:{{clipPath}};
                    clip-path:{{clipPath}};">
        <svg class="output-overlay"
             width="{{width}}"
             height="{{height}}"
             viewbox="0 0 {{width}} {{height}}">
          <g class="photograb-waiting">
            {{#each unappliedMarks}}{{> mark}}{{/each}}
          </g>
          {{#if currentMark}}{{> mark currentMark }}{{/if}}
        </svg>
      </div>
    </div>
  </div>
</template>

<template name="mark">
  <path class="mark"
        d="{{path}}"
        stroke="{{stroke}}"
        fill="none"
        stroke-width="{{strokeWidth}}"
        stroke-linecap="round"
        stroke-linejoin="round">
  </path>
</template>

<template name="mask">
  <path class="mask"
        d="{{path}}"
        {{attributes}}/>
</template>
